<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Assignment Planner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4">
<h1 class="text-center mb-4">Task Assignment Planner</h1>

<div class="row mb-4">
    <div class="col">
        <h4>Add Employee</h4>
        <input type="text" id="employeeName" class="form-control" placeholder="Employee name">
        <button class="btn btn-primary mt-2" onclick="addEmployee()">Add Employee</button>
        <ul id="employeeList" class="mt-2"></ul>
    </div>

    <div class="col">
        <h4>Add Task</h4>
        <input type="text" id="taskName" class="form-control" placeholder="Task name">
        <select id="preferredEmployee" class="form-select mt-2">
            <option value="">-- Preferred Employee (optional) --</option>
        </select>
        <button class="btn btn-success mt-2" onclick="addTask()">Add Task</button>
        <ul id="taskList" class="mt-2"></ul>
    </div>
</div>

<div class="text-center">
    <button class="btn btn-lg btn-purple" onclick="solve()">Solve</button>
</div>

<h3 class="mt-4">Assignments</h3>
<table class="table table-bordered mt-2">
    <thead class="table-light">
    <tr>
        <th>Task</th>
        <th>Assigned</th>
        <th>Preferred</th>
    </tr>
    </thead>
    <tbody id="assignmentTable"></tbody>
</table>

<script>
    let employees = [];
    let tasks = [];

    function addEmployee() {
        const name = document.getElementById('employeeName').value.trim();
        if (name && !employees.find(e => e.name === name)) {
            employees.push({ name });
            updateUI();
        }
        document.getElementById('employeeName').value = '';
    }

    function addTask() {
        const name = document.getElementById('taskName').value.trim();
        const preferred = document.getElementById('preferredEmployee').value;
        if (name) {
            tasks.push({ id: Date.now().toString(), taskName: name, preferredEmployeeName: preferred || null });
            updateUI();
        }
        document.getElementById('taskName').value = '';
        document.getElementById('preferredEmployee').value = '';
    }

    function updateUI() {
        const employeeList = document.getElementById('employeeList');
        const taskList = document.getElementById('taskList');
        const preferredSelect = document.getElementById('preferredEmployee');

        employeeList.innerHTML = employees.map(e => `<li>${e.name}</li>`).join('');
        taskList.innerHTML = tasks.map(t => `<li>${t.taskName}${t.preferredEmployeeName ? ` (Pref: ${t.preferredEmployeeName})` : ''}</li>`).join('');

        preferredSelect.innerHTML = `<option value="">-- Preferred Employee (optional) --</option>` +
            employees.map(e => `<option value="${e.name}">${e.name}</option>`).join('');
    }

    function solve() {
        fetch('/api/planning/solve', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ employeeList: employees, taskList: tasks })
        })
            .then(res => res.json())
            .then(data => {
                const table = document.getElementById('assignmentTable');
                table.innerHTML = data.taskList.map(t => {
                    const mismatch = t.preferredEmployeeName && t.assignedEmployeeName !== t.preferredEmployeeName;
                    return `
                        <tr class="${mismatch ? 'table-warning' : ''}">
                          <td>${t.taskName}</td>
                          <td>${t.assignedEmployeeName || '-'}</td>
                          <td>${t.preferredEmployeeName || '-'}</td>
                        </tr>
                      `;
                }).join('');

            })
            .catch(err => alert('Error: ' + err.message));
    }
</script>

<style>
    .btn-purple {
        background-color: #9b59b6;
        color: white;
    }
    .btn-purple:hover {
        background-color: #8e44ad;
    }
</style>
</body>
</html>
